{% extends "base.html" %}

{% block content %}

    <h1>üìù –ó–∞–¥–∞—á–∞: {{ task.title }}</h1>
    <p>–û–ø–∏—Å–∞–Ω–∏–µ: {{ task.description }}</p>
    <p>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: {{ task.assignee.first_name }} {{ task.assignee.last_name }}</p>
    <p>–°—Ç–∞—Ç—É—Å: {{ task.get_status_display }}</p>
    <p>–î–µ–¥–ª–∞–π–Ω: {{ task.deadline|date:"d.m.Y H:i" }}</p>

    {% if can_edit %}
        <a href="{% url 'task_update' task.id %}" class="btn btn-primary">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'task_delete' task.id %}" class="btn btn-danger" onclick="return confirm('–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?');">üóë –£–¥–∞–ª–∏—Ç—å</a>
    {% endif %}

    <hr>

    {% if can_change_status %}
        <h3>‚ö° –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏</h3>
        <form method="post" action="{% url 'task_change_status' task.id %}" style="display:inline">
            {% csrf_token %}
            <select name="status">
                {% for value, label in task.Status.choices %}
                    <option value="{{ value }}" {% if task.status == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-secondary">üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        </form>
    {% endif %}

    <hr>

    <h3>üìä –û—Ü–µ–Ω–∫–∏</h3>

    {% for evaluation in evaluations %}
        <p><strong>{{ evaluation.user.first_name }} {{ evaluation.user.last_name }}:</strong> {{ evaluation.score }} <em>({{ evaluation.created_at|date:"d.m.Y H:i" }})</em></p>
    {% empty %}
        <p>–ü–æ–∫–∞ –æ—Ü–µ–Ω–æ–∫ –Ω–µ—Ç</p>
    {% endfor %}

    {% if can_add_evaluation %}
        <hr>
        <h4>‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h4>
        <form method="post" action="{% url 'evaluation_add' task.id request.user.id %}">
            {% csrf_token %}
            {{ evaluation_form.as_p }}
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
        </form>
    {% endif %}

    <a href="{% url 'team_detail' pk=task.team.id %}" class="btn btn-light">‚¨Ö –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º</a>

    <hr>

    <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

    {% for comment in task.comments.all %}
        <p><strong>{{ comment.author.first_name }} {{ comment.author.last_name }}:</strong> {{ comment.content }} <em>({{ comment.created_at|date:"d.m.Y H:i" }})</em></p>
    {% empty %}
        <p>–ü–æ–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç</p>
    {% endfor %}

    <form method="post" action="{% url 'task_comment_create' task.id %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
    </form>

{% endblock %}