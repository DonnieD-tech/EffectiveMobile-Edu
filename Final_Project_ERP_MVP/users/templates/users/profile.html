{% extends "base.html" %}

{% block content %}

    <h1>üë§ –ü—Ä–æ—Ñ–∏–ª—å: {{ profile_user.name|default:profile_user.email }}</h1>
    <p><strong>–ò–º—è:</strong> {{ profile_user.first_name }} {{ profile_user.last_name }}</p>
    <p><strong>Email:</strong> {{ profile_user.email }}</p>
    <p><strong>–†–æ–ª—å:</strong> {{ profile_user.get_role_display }}</p>
    <a href="{% url 'meeting_list' %}" class="btn btn-secondary">‚è∞ –ú–æ–∏ –≤—Å—Ç—Ä–µ—á–∏</a>
    <a href="{% url 'calendar' %}" class="btn btn-secondary">üìÜ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</a>
    {% if profile_user.team %}
        <p>
            <a href="{% url 'team_detail' profile_user.team.id %}" class="btn btn-secondary">
                <strong>ü§ù –ö–æ–º–∞–Ω–¥–∞:</strong> {{ profile_user.team.name }}
            </a>
        </p>
    {% else %}
        {% if not profile_user.is_superuser %}
            <a href="{% url 'join_team' %}" class="btn btn-secondary">
                –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ
            </a>
        {% endif %}
    {% endif %}
    <hr>
    <a href="{% url 'user_profile_edit' %}" class="btn btn-secondary">‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="{% url 'user_delete' %}" class="btn btn-danger">‚ùå –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>


    {% if user.is_superuser %}
      <hr>
      <div class="team-management">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏  <a href="{% url 'team_create' %}" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</a></h2>
        {% if teams %}
            <div class="team-cards-container">
            {% for team in teams %}
                <div class="card">
                    <div class="card-body">
                        <span class="card-title">{{ team.name }}</span>
                        <span class="card-code">Invite Code: {{ team.invite_code }}</span>
                        <a href="{% url 'team_detail' team.id %}" class="btn">‚öôÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
                    </div>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <p>–ö–æ–º–∞–Ω–¥ –ø–æ–∫–∞ –Ω–µ—Ç üëå</p>
        {% endif %}
      </div>
    {% endif %}

    {% if request.user.role not in "admin_team manager" %}
        <hr>
        <h2>üèÜ –û—Ü–µ–Ω–∫–∏</h2>
        <p>
            <strong>‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:</strong>
            {% if avg_score %}
                {{ avg_score }}
            {% else %}
                –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫
            {% endif %}
        </p>

        <h3>üíπ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3>

        {% if avg_score_month %}
            <p>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü: <strong>{{ avg_score_month|floatformat:1 }}</strong></p>
        {% endif %}

        {% if recent_evaluations %}
            <table border="1" cellpadding="6">
                <tr>
                    <th>–ó–∞–¥–∞—á–∞</th>
                    <th>–û—Ü–µ–Ω–∫–∞</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    <th>–ö—Ç–æ –æ—Ü–µ–Ω–∏–ª</th>
                    <th>–ö–æ–≥–¥–∞</th>
                </tr>
                {% for ev in recent_evaluations %}
                <tr>
                    <td>
                        <a href="{% url 'task_detail' ev.task.id %}">{{ ev.task.title }}</a>
                    </td>
                    <td>{{ ev.score }}</td>
                    <td>{{ ev.comment|default:"‚Äî" }}</td>
                    <td>{{ ev.created_by.name|default:ev.created_by.email }}</td>
                    <td>{{ ev.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
                {% endfor %}
            </table>
            {% if evaluation_count > recent_evaluations|length %}
                <p><a href="{% url 'user_evaluations' profile_user.id %}">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏</a></p>
            {% endif %}
        {% else %}
            <p>–ü–æ–∫–∞ –æ—Ü–µ–Ω–æ–∫ –Ω–µ—Ç.</p>
        {% endif %}
    {% endif %}

{% endblock %}
